2025-05-11 20:01:08,748 - IrrigationSystem - INFO - AlarmModule initialized. Threshold: 30%, Enabled: True
.2025-05-11 20:01:08,749 - IrrigationSystem - INFO - AlarmModule initialized. Threshold: 30%, Enabled: True
2025-05-11 20:01:08,749 - IrrigationSystem - INFO - 禁用报警系统。
2025-05-11 20:01:08,749 - IrrigationSystem - INFO - 启用报警系统。
....2025-05-11 20:01:08,752 - IrrigationSystem - INFO - ControlExecutionModule initialized.
.2025-05-11 20:01:08,752 - IrrigationSystem - INFO - ControlExecutionModule initialized.
2025-05-11 20:01:08,752 - IrrigationSystem - INFO - 启动灌溉，持续30分钟。
2025-05-11 20:01:08,752 - IrrigationSystem - INFO - 灌溉成功启动，将持续30分钟。
2025-05-11 20:01:08,752 - IrrigationSystem - INFO - Logging irrigation event: {'timestamp': datetime.datetime(2025, 5, 11, 20, 1, 8, 752987), 'event': 'start', 'status': 'logged', 'duration_planned_seconds': 1800, 'start_time': datetime.datetime(2025, 5, 11, 20, 1, 8, 752972)}
2025-05-11 20:01:08,753 - IrrigationSystem - INFO - 停止灌溉。
2025-05-11 20:01:08,753 - IrrigationSystem - INFO - 灌溉已成功停止。
2025-05-11 20:01:08,753 - IrrigationSystem - INFO - Logging irrigation event: {'timestamp': datetime.datetime(2025, 5, 11, 20, 1, 8, 753029), 'event': 'stop', 'status': 'completed', 'start_time': datetime.datetime(2025, 5, 11, 20, 1, 8, 752972), 'end_time': datetime.datetime(2025, 5, 11, 20, 1, 8, 753029), 'duration_actual_seconds': 5.7e-05}
.2025-05-11 20:01:08,753 - IrrigationSystem - INFO - DataCollectionModule initialized for sensors: ['test-sensor-1', 'test-sensor-2']
E2025-05-11 20:01:08,754 - IrrigationSystem - INFO - DataCollectionModule initialized for sensors: ['test-sensor-1', 'test-sensor-2']
.2025-05-11 20:01:08,755 - IrrigationSystem - INFO - DataCollectionModule initialized for sensors: ['test-sensor-1', 'test-sensor-2']
E2025-05-11 20:01:08,755 - IrrigationSystem - INFO - DataCollectionModule initialized for sensors: ['test-sensor-1', 'test-sensor-2']
E2025-05-11 20:01:08,755 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,755 - IrrigationSystem - INFO - Fetching weather data for Tokyo
2025-05-11 20:01:08,755 - IrrigationSystem - ERROR - Unexpected error processing weather data: API连接错误
Traceback (most recent call last):
  File "/Volumes/app/DevelopProject/SmartIrrigation/src/data/data_processing.py", line 85, in get_weather_data
    response = requests.get(self.weather_api_url, params=params, timeout=10)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1139, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1143, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1198, in _execute_mock_call
    raise effect
Exception: API连接错误
.2025-05-11 20:01:08,755 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,755 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,755 - IrrigationSystem - WARNING - Weather API key not set, cannot fetch weather data
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,756 - IrrigationSystem - INFO - Fetching weather data for Tokyo
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
E2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,756 - IrrigationSystem - ERROR - Invalid sensor data: 无效数据
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Could not fetch weather data: API错误
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Invalid soil moisture value: 150.0
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Unusual temperature value: 70.0
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Missing temperature value, setting to default 0.0
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Missing light_intensity value, setting to default 0.0
2025-05-11 20:01:08,756 - IrrigationSystem - WARNING - Missing rainfall value, setting to default 0.0
.2025-05-11 20:01:08,756 - IrrigationSystem - INFO - DataProcessingModule initialized.
.2025-05-11 20:01:08,757 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:08,757 - IrrigationSystem - INFO - Stored weather data for Tokyo to database
./Volumes/app/DevelopProject/SmartIrrigation/tests/test_database.py:129: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  timestamp=datetime.utcnow(),
/Volumes/app/DevelopProject/SmartIrrigation/.venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:3625: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore
../Volumes/app/DevelopProject/SmartIrrigation/tests/test_database.py:84: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.utcnow()
./Volumes/app/DevelopProject/SmartIrrigation/tests/test_database.py:38: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.utcnow()
../Volumes/app/DevelopProject/SmartIrrigation/tests/test_database.py:62: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  now = datetime.utcnow()
...F/Volumes/app/DevelopProject/SmartIrrigation/src/logger_config/logger_config.py:34: ResourceWarning: unclosed file <_io.TextIOWrapper name='/Volumes/app/DevelopProject/SmartIrrigation/irrigation_system.log' mode='a' encoding='UTF-8'>
  logger.handlers.clear()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-05-11 20:01:08,782 - TestLogger - INFO - 测试日志消息
F2025-05-11 20:01:08,782 - IrrigationSystem - INFO - LangChain LLM Agent initialized.
2025-05-11 20:01:08,782 - IrrigationSystem - INFO - 基于当前湿度: 20% 和预测湿度: None% 做出灌溉决策
2025-05-11 20:01:08,782 - IrrigationSystem - INFO - 决策: 启动灌溉。原因: 当前湿度 (20%) 低于阈值 (30.0%)。
.2025-05-11 20:01:08,783 - IrrigationSystem - INFO - LangChain LLM Agent initialized.
.usage: python3 -m unittest [-h] [--init-db] [--config CONFIG] [--no-ui]
                           [--share]
python3 -m unittest: error: unrecognized arguments: discover tests
.2025-05-11 20:01:10,922 - IrrigationSystem - WARNING - No model path provided, initializing a new model structure.
2025-05-11 20:01:10,922 - IrrigationSystem - INFO - Initializing new prediction model structure.
2025-05-11 20:01:10,922 - IrrigationSystem - WARNING - Using dummy prediction model! Replace with actual ML model in production.
2025-05-11 20:01:10,922 - IrrigationSystem - INFO - Performing prediction...
2025-05-11 20:01:10,922 - IrrigationSystem - INFO - Predicted future humidity: 37.856191958554234%
...2025-05-11 20:01:10,966 - IrrigationSystem - INFO - LangChain LLM Agent initialized.
2025-05-11 20:01:10,966 - IrrigationSystem - INFO - ControlExecutionModule initialized.
2025-05-11 20:01:10,966 - IrrigationSystem - INFO - DataCollectionModule initialized for sensors: ['sensor_001', 'sensor_002']
2025-05-11 20:01:10,967 - IrrigationSystem - INFO - DataProcessingModule initialized.
2025-05-11 20:01:10,967 - IrrigationSystem - INFO - UserInterfaceModule initialized.
2025-05-11 20:01:10,967 - IrrigationSystem - INFO - 收到用户输入: '预测湿度'
2025-05-11 20:01:12,108 - IrrigationSystem - INFO - 解析到 action: langchain_agent
2025-05-11 20:01:12,108 - IrrigationSystem - INFO - langchain_agent answer: 请提供相关数据，例如：

1. 历史湿度数据（例如：时间和湿度值）。
2. 影响湿度的因素（例如：温度、降雨量、风速等）。
3. 需要预测的时间范围或条件。

有了这些数据后，我可以使用线性回归等工具进行预测。
.
======================================================================
ERROR: test_collect_and_store (test_data_collection.TestDataCollectionModule.test_collect_and_store)
测试数据采集和存储
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1393, in patched
    with self.decoration_helper(patched,
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 137, in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1375, in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 526, in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1451, in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py", line 528, in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
AttributeError: module 'src' has no attribute 'data_collection'

======================================================================
ERROR: test_get_data_error (test_data_collection.TestDataCollectionModule.test_get_data_error)
测试数据获取错误处理
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1393, in patched
    with self.decoration_helper(patched,
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 137, in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1375, in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 526, in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1451, in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py", line 528, in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
AttributeError: module 'src' has no attribute 'data_collection'

======================================================================
ERROR: test_init (test_data_collection.TestDataCollectionModule.test_init)
测试初始化
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Volumes/app/DevelopProject/SmartIrrigation/tests/test_data_collection.py", line 24, in test_init
    with patch('src.data_collection.config') as mock_config:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1451, in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py", line 528, in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
AttributeError: module 'src' has no attribute 'data_collection'

======================================================================
ERROR: test_init (test_data_processing.TestDataProcessingModule.test_init)
测试初始化
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Volumes/app/DevelopProject/SmartIrrigation/tests/test_data_processing.py", line 39, in test_init
    with patch('src.smart_irrigation.data_processing.config') as mock_config:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py", line 1451, in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py", line 528, in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
AttributeError: module 'src' has no attribute 'smart_irrigation'

======================================================================
FAIL: test_logger_setup (test_exceptions.TestLogger.test_logger_setup)
测试日志记录器设置
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Volumes/app/DevelopProject/SmartIrrigation/tests/test_exceptions.py", line 79, in test_logger_setup
    self.assertEqual(logger.level, logging.DEBUG)
AssertionError: 20 != 10

======================================================================
FAIL: test_logger_write (test_exceptions.TestLogger.test_logger_write)
测试日志写入
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Volumes/app/DevelopProject/SmartIrrigation/tests/test_exceptions.py", line 107, in test_logger_write
    self.assertIn(test_message, log_content)
AssertionError: '测试日志消息' not found in ''

----------------------------------------------------------------------
Ran 39 tests in 3.360s

FAILED (failures=2, errors=4)
